<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SPY - მისტიკური თამაში</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Raleway:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="manifest" href="/manifest.json" />
    <style>
      :root {
        --color1: #d94f4f; /* deeper red */
        --color2: #4a3f72; /* deeper purple */
        --color3: #5a8233; /* deeper green */
        --color4: #cfa2a2; /* muted pink */
        --color5: #6f81a8; /* muted blue */
        --bg-gradient: linear-gradient(135deg, #121212, #1e1e1e);
        --text-light: #e0e0e0;
        --shadow-glow: 0 0 8px rgba(217, 79, 79, 0.8);
        --transition: all 0.35s ease;
      }
     

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }
     
html, body {
  height: 100%;
  background: var(--bg-gradient);
  overflow-x: hidden;
  overscroll-behavior: none; /* iOS bounce-scroll თავიდან ასაცილებლად */
}


      body {
        font-family: "Raleway", sans-serif;
        min-height: 100vh;
        background: var(--bg-gradient);
        color: var(--text-light);
        background-attachment: fixed; 
        display: flex;
        justify-content: center;
        align-items: center;

 flex-direction: column;   /* ახალი */
  justify-content: flex-start; /* ახალი */

        padding: 2rem;
        overflow-x: hidden;
        transition: opacity 0.5s ease-in-out;
        position: relative;
      }

      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
            circle at 15% 30%,
            rgba(217, 79, 79, 0.12) 0%,
            transparent 45%
          ),
          radial-gradient(
            circle at 80% 70%,
            rgba(90, 130, 51, 0.12) 0%,
            transparent 45%
          ),
          radial-gradient(circle at 50% 50%, rgba(74, 63, 114, 0.12) 0%, transparent 55%);
        pointer-events: none;
        z-index: -1;
        animation: backgroundPulse 14s ease-in-out infinite alternate;
        filter: none;
      }

      @keyframes backgroundPulse {
        0% {
          filter: brightness(1);
        }
        100% {
          filter: brightness(1.08);
        }
      }

      .particles {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -1;
        overflow: visible;
        filter: drop-shadow(0 0 1.5px var(--color1));
        animation: particlesPulse 11s linear infinite;
      }

      @keyframes particlesPulse {
        0%,
        100% {
          opacity: 0.5;
        }
        50% {
          opacity: 0.85;
        }
      }

      .particle {
        position: absolute;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--color1), var(--color4));
        opacity: 0.6;
        animation: floatUp 20s linear infinite;
        box-shadow: 0 0 4px var(--color1), 0 0 8px var(--color4);
      }

      @keyframes floatUp {
        0% {
          transform: translateY(100vh) rotate(0deg);
          opacity: 0;
        }
        10% {
          opacity: 0.6;
        }
        90% {
          opacity: 0.25;
        }
        100% {
          transform: translateY(-120vh) rotate(360deg);
          opacity: 0;
        }
      }

      /* Container with slight increase in max-width and padding for better layout */
      .container {
        background: rgba(20, 20, 20, 0.9);
        border-radius: 20px;
        padding: 3.5rem 3rem;
        max-width: 680px; /* increased from 640px */
        width: 100%;
        box-shadow: 0 0 25px rgba(217, 79, 79, 0.8),
          inset 0 0 15px rgba(217, 79, 79, 0.25);
        position: relative;
        overflow: hidden;
        border: 1.5px solid transparent;
        background-clip: padding-box;
        transition: box-shadow 0.5s ease;
      }

      .container::before {
        content: "";
        position: absolute;
        top: -10%;
        left: -10%;
        width: 120%;
        height: 120%;
        border-radius: 30%;
        background: conic-gradient(
          from 0deg,
          var(--color1),
          var(--color2),
          var(--color3),
          var(--color4),
          var(--color5),
          var(--color1)
        );
        opacity: 0.25;
        pointer-events: none;
        z-index: 0;
        filter: drop-shadow(0 0 6px var(--color1));
        animation: rotateGradient 25s linear infinite;
      }

      @keyframes rotateGradient {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .container > * {
        position: relative;
        z-index: 1;
      }

      /* Logo styling */
      .logo {
        text-align: center;
        margin-bottom: 2rem;
        user-select: none;
      }

      .logo h1 {
        font-family: "Cinzel", serif;
        font-size: 3.6rem;
        color: var(--color1);
        text-shadow: 0 0 6px var(--color1), 0 0 14px var(--color4);
        letter-spacing: 4px;
        font-weight: 700;
        position: relative;
        display: inline-block;
        animation: glowPulse 4s infinite alternate;
      }

      @keyframes glowPulse {
        0% {
          text-shadow: 0 0 6px var(--color1), 0 0 14px var(--color4);
        }
        100% {
          text-shadow: 0 0 14px var(--color5), 0 0 20px var(--color1),
            0 0 24px var(--color4);
        }
      }

      /* Adjusted paragraph in logo for loading screen - moved slightly down */
      #readyScreen .logo p {
        margin-top: 1rem; /* increased margin */
        display: block;
        position: relative;
        top: 6px; /* moved down */
        font-weight: 300;
        font-size: 1.25rem;
        color: var(--color4);
        font-style: italic;
        letter-spacing: 0.1em;
        text-shadow: 0 0 4px var(--color4);
      }

      /* Hide logo paragraph in main content to show only SPY */
      #mainContent .logo p {
        display: none;
      }

      /* Sections */
      .section {
        display: none;
        animation: fadeInUp 0.5s ease forwards;
      }

      .active {
        display: block;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(15px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .input-group {
         /* margin-bottom: 1.5rem;  */
         margin-bottom: 1rem;
      }

      .input-group + .input-group {
        /* margin-top: 1rem; */
      }

      /* Spy count label moved slightly down */
      .input-group label.form-label {
        display: flex;
        align-items: center;
         gap: 0.3rem; 
        font-weight: 700;
        color: var(--color4);
        font-size: 1.1rem;
        margin-bottom: 1.2rem; /* increased from 0.8rem */
        position: relative;
        top: 8px; /* moved down slightly */
        user-select: none;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
      }

      .form-label i {
        color: var(--color1);
        font-size: 1.4rem;
      }

      .input-with-button {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
        flex-wrap: wrap; /* Added for responsiveness */
      }

      input,
      select {
        flex: 1;
        padding: 1rem 1.4rem;
        font-size: 1.05rem;
        border-radius: 15px;
        border: 2px solid var(--color5);
        background: rgba(30, 30, 30, 0.85);
        color: var(--text-light);
        font-family: "Raleway", sans-serif;
        transition: var(--transition);
        box-shadow: inset 0 0 5px rgba(146, 168, 209, 0.7);
      }

      input::placeholder {
        color: var(--color5);
        opacity: 0.7;
        font-style: italic;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: var(--color3);
        box-shadow: 0 0 10px var(--color3), inset 0 0 8px var(--color3);
        background: rgba(30, 40, 20, 0.95);
      }

      .btn {
        padding: 1rem 2.2rem;
        background: linear-gradient(45deg, var(--color3), var(--color1));
        color: var(--text-light);
        font-weight: 700;
        font-family: "Raleway", sans-serif;
        font-size: 1.1rem;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        box-shadow: 0 6px 18px rgba(136, 176, 75, 0.8);
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.6rem;
        user-select: none;
        text-shadow: 0 0 5px rgba(255 255 255 / 0.3);
      }

      .btn:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 10px 25px rgba(136, 176, 75, 1), 0 0 15px var(--color1);
        background: linear-gradient(45deg, var(--color1), var(--color3));
        color: #fff;
      }

      .btn:active {
        transform: translateY(0) scale(1);
        box-shadow: 0 5px 15px rgba(136, 176, 75, 0.6);
      }

      .btn-outline {
        background: transparent;
        border: 2px solid var(--color1);
        color: var(--color1);
        box-shadow: none;
        transition: var(--transition);
      }

      .btn-outline:hover {
        background: var(--color1);
        color: var(--text-light);
        box-shadow: 0 0 10px var(--color1), 0 0 15px var(--color4);
      }

      .btn-danger {
        background: linear-gradient(135deg, #8B0000, #C41E3A);
        box-shadow: 0 6px 18px rgba(196, 30, 58, 0.8);
        color: #fff;
      }

      .btn-danger:hover {
        box-shadow: 0 10px 25px rgba(196, 30, 58, 1);
        background: linear-gradient(135deg, #C41E3A, #8B0000);
      }

      .btn-group {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
        justify-content: center;
        flex-wrap: wrap;
      }

      .player-list {
        background: rgba(20, 20, 20, 0.7);
        border-radius: 15px;
        padding: 1rem 1.2rem;
        max-height: 220px;
        overflow-y: auto;
        border: 2px solid var(--color5);
        box-shadow: inset 0 0 10px rgba(146, 168, 209, 0.5);
      }

      .player-item {
        background: linear-gradient(90deg, var(--color4) 0%, var(--color1) 100%);
        padding: 0.85rem 1rem;
        margin-bottom: 0.9rem;
        border-radius: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: #222;
        font-weight: 600;
        font-size: 1.05rem;
        box-shadow: 0 3px 8px rgba(255, 111, 97, 0.5);
        cursor: default;
        user-select: none;
        transition: background 0.3s ease;
      }

      .player-item:hover {
        background: linear-gradient(90deg, var(--color1), var(--color4));
        box-shadow: 0 5px 15px rgba(255, 111, 97, 0.8);
        transform: translateX(6px);
      }

      .player-item:last-child {
        margin-bottom: 0;
      }

      .player-name-and-points {
        display: flex;
        align-items: center;
        gap: 1rem;
        color: #222;
      }

      .player-score {
        font-size: 0.95rem;
        font-weight: 700;
        color: var(--color3);
        text-shadow: 0 0 6px var(--color3);
      }

      .remove-btn {
        background: transparent;
        border: none;
        color: var(--color1);
        font-size: 1.4rem;
        cursor: pointer;
        transition: var(--transition);
        padding: 0;
        display: flex;
        align-items: center;
      }

      .remove-btn:hover {
        color: var(--color3);
        transform: scale(1.3);
        text-shadow: 0 0 8px var(--color3);
      }

      .points-display {
        font-size: 1.4rem;
        font-weight: 700;
        color: var(--color3);
        text-align: center;
        margin-bottom: 2rem;
        text-shadow: 0 0 8px var(--color3);
        user-select: none;
      }

      .role-display {
        background: rgba(40, 40, 40, 0.7);
        border-radius: 20px;
        padding: 3rem 2rem;
        margin: 2rem 0;
        text-align: center;
        border: 2px solid var(--color5);
        box-shadow: inset 0 0 20px rgba(146, 168, 209, 0.5);
        min-height: 180px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        user-select: none;
      }

      .role-text {
        font-size: 2.8rem;
        font-weight: 700;
        color: var(--color3);
        margin-bottom: 1.5rem;
        text-shadow: 0 0 10px var(--color3), 0 0 20px var(--color1);
        transition: color 0.4s ease;
      }

      .spy-text {
        color: #E03C3C;
        text-shadow: 0 0 15px #E03C3C, 0 0 30px #FF6F61;
        font-weight: 900;
        font-size: 3rem;
        letter-spacing: 0.12em;
        animation: pulseSpy 2.5s infinite alternate;
      }

      @keyframes pulseSpy {
        0% {
          text-shadow: 0 0 15px #E03C3C, 0 0 30px #FF6F61;
        }
        100% {
          text-shadow: 0 0 25px #FF6F61, 0 0 40px #E03C3C;
        }
      }

      .word-text {
        color: var(--color1);
        font-style: italic;
        font-weight: 700;
        font-size: 2.6rem;
        letter-spacing: 0.1em;
        text-shadow: 0 0 10px var(--color1), 0 0 20px var(--color4);
        user-select: text;
      }

      .current-player {
        font-size: 1.3rem;
        color: var(--color5);
        margin-top: 0.6rem;
        font-weight: 600;
        letter-spacing: 0.05em;
        user-select: none;
        text-shadow: 0 0 6px var(--color5);
      }

      .timer-container {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 2.5rem 0;
        user-select: none;
      }

      .timer {
        font-size: 4.5rem;
        font-weight: 900;
        color: var(--color1);
        text-shadow: 0 0 25px var(--color1), 0 0 40px var(--color4);
        font-family: "Cinzel", serif;
        letter-spacing: 0.15em;
        padding: 1.2rem 3rem;
        background: rgba(30, 30, 30, 0.8);
        border-radius: 25px;
        min-width: 220px;
        text-align: center;
        border: 2px solid var(--color3);
        transition: color 0.3s ease;
      }

      .timer.danger {
        color: #E03C3C;
        text-shadow: 0 0 25px #E03C3C, 0 0 40px #FF6F61;
        border-color: #E03C3C;
      }

      .result-display {
        background: rgba(40, 40, 40, 0.75);
        border-radius: 25px;
        padding: 3rem 2rem;
        margin: 3rem 0;
        text-align: center;
        border: 2px solid var(--color4);
        box-shadow: inset 0 0 20px rgba(255, 111, 97, 0.4);
        user-select: none;
      }

      .result-title {
        color: var(--color1);
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 2rem;
        text-shadow: 0 0 10px var(--color1);
      }

      .spies-list {
        color: #E03C3C;
        font-size: 2rem;
        font-weight: 700;
        margin: 1.5rem 0;
        text-shadow: 0 0 10px #E03C3C, 0 0 15px #FF6F61;
        letter-spacing: 0.1em;
        user-select: text;
      }

      .word-reveal {
        color: var(--color1);
        font-size: 1.8rem;
        margin: 1.5rem 0;
        font-style: italic;
        font-weight: 600;
        letter-spacing: 0.05em;
        text-shadow: 0 0 10px var(--color4);
        user-select: text;
      }

      .controls {
        display: flex;
        gap: 1.3rem;
        justify-content: center;
        margin-top: 2.5rem;
        flex-wrap: wrap; /* Added for responsiveness */
      }

      .player-turn {
        font-size: 1.7rem;
        color: var(--color4);
        margin-bottom: 2rem;
        text-align: center;
        font-weight: 800;
        letter-spacing: 0.08em;
        user-select: none;
        text-shadow: 0 0 10px var(--color4);
      }

      .select-spy-section {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 3rem 0;
        animation: fadeInUp 0.6s ease forwards;
      }

      .select-spy-section p {
        font-size: 1.3rem;
        margin-bottom: 1.2rem;
        font-weight: 600;
        color: var(--color5);
        user-select: none;
        text-shadow: 0 0 6px var(--color5);
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1200;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(15, 15, 15, 0.95);
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
        justify-content: center;
        align-items: center;
        animation: fadeInUp 0.4s ease forwards;
        user-select: none;
      }

      .modal-content {
        background-color: #111;
        padding: 2.8rem 3rem;
        border-radius: 25px;
        border: 3px solid var(--color1);
        width: 90%;
        max-width: 440px;
        text-align: center;
        box-shadow: 0 0 30px var(--color1);
        animation: scaleIn 0.3s ease forwards;
        user-select: text;
      }

      .modal-content h3 {
        color: var(--color1);
        font-size: 2rem;
        margin-bottom: 2rem;
        font-weight: 800;
        text-shadow: 0 0 15px var(--color1);
      }

      .modal-content p {
        font-size: 1.3rem;
        color: var(--text-light);
        margin-bottom: 2rem;
        line-height: 1.4;
      }

      .modal-buttons {
        display: flex;
        justify-content: center;
        gap: 1.2rem;
        flex-wrap: wrap;
      }

      #finalPointsModal .modal-content {
        text-align: left;
      }

      #finalPointsModal .player-score-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 1.1rem;
        padding: 0.9rem 0;
        border-bottom: 1px solid rgba(255, 111, 97, 0.2);
        font-weight: 600;
        color: var(--text-light);
        user-select: text;
      }

      #finalPointsModal .player-score-item:last-child {
        border-bottom: none;
      }

      #finalPointsModal .player-score-item .name {
        color: var(--color4);
      }

      #finalPointsModal .player-score-item .points {
        font-weight: 700;
        color: var(--color3);
        text-shadow: 0 0 6px var(--color3);
      }

      /* Loading Screen Styles */

      #loadingScreen,
      #readyScreen,
      #transitionScreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--bg-gradient);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: var(--text-light);
        z-index: 1500;
        transition: opacity 0.6s ease-in-out;
        text-align: center;
        user-select: none;
      }

      #loadingScreen .spinner,
      #transitionScreen .spinner {
        border: 6px solid rgba(255, 111, 97, 0.15);
        border-left-color: var(--color1);
        border-radius: 50%;
        width: 70px;
        height: 70px;
        animation: spin 1.3s linear infinite;
        margin-bottom: 2rem;
        box-shadow: 0 0 15px var(--color1);
      }

      #loadingScreen .loading-text,
      #transitionScreen .loading-text {
        font-family: "Cinzel", serif;
        font-size: 2.4rem;
        color: var(--color1);
        letter-spacing: 0.15em;
        animation: pulse 1.8s infinite ease-in-out;
        text-shadow: 0 0 10px var(--color1), 0 0 20px var(--color4);
      }

      /* Adjusted readyScreen to flex and added gap */
      #readyScreen {
        display: none;
        flex-direction: column;
        gap: 2rem;
        padding: 1rem 2rem;
        user-select: none;
        text-align: center;
      }

      #readyScreen h2 {
        font-family: "Cinzel", serif;
        font-size: 2.8rem;
        color: var(--color3);
        margin-bottom: 1rem;
        text-shadow: 0 0 10px var(--color3);
        font-weight: 700;
        letter-spacing: 0.05em;
      }

      #readyScreen p {
        font-size: 1.25rem;
        color: var(--color5);
        max-width: 480px;
        line-height: 1.5;
        margin: 0 auto 2.5rem;
        user-select: text;
        text-shadow: 0 0 6px var(--color5);
      }
      .findSpySelect{
        position: relative;
        bottom: -20px;
      }

      #readyScreen .btn {
        font-size: 1.3rem;
        padding: 1.2rem 3.2rem;
      }
      .im-ready{
        position: relative;
        top: -40px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 0.8;
          transform: scale(1);
        }
        50% {
          opacity: 1;
          transform: scale(1.05);
        }
      }

      @keyframes scaleIn {
        from {
          transform: scale(0.9);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }

      /* Responsive styles */
      @media (max-width: 768px) {
        .container {
            padding: 2.5rem 1.5rem;  
            max-width: 95vw; /* slightly wider */
        }

        .logo h1 {
          font-size: 2.8rem;
        }

        /* on mobile, show only SPY text, so #mainContent .logo p is hidden already */

        .input-with-button {
          flex-direction: column;
          gap: 1rem;
        }

        input,
        select {
          font-size: 1rem;
          padding: 0.9rem 1.2rem;
        }

        .timer {
          font-size: 3.5rem;
          padding: 1rem 2rem;
        }

        .role-text {
          font-size: 2rem;
        }

        .controls {
          flex-direction: column;
          gap: 1rem;
        }

        .btn {
          width: 100%;
          font-size: 1rem;
        }

        #loadingScreen .loading-text,
        #readyScreen h2 {
          font-size: 1.8rem;
        }

        #readyScreen p {
          font-size: 1rem;
          max-width: 90vw;
        }

        #readyScreen .btn {
          font-size: 1rem;
          padding: 1rem 2rem;
        }

        .btn-group {
          flex-direction: column;
          gap: 1rem;
        }

        .result-buttons {
          flex-direction: column;
          gap: 1.2rem;
        }
      }
    </style>
</head>
<body>
  <div id="loadingScreen">
    <div class="spinner"></div>
    <div class="loading-text">იტვირთება...</div>
  </div>

  <div id="readyScreen" style="display:none;">
    <div class="logo">
      <h1>SPY</h1>
      <p>მისტიკური თამაში რეალობის გამოცდისთვის</p>
    </div>
    <h2>მზად ხართ საიდუმლოს გასამჟღავნებლად?</h2>
    <p>
      მოემზადეთ და დაიწყეთ თამაში, მაგრამ გაითვალისწინეთ: ერთ-ერთი თქვენგანი ჯაშუშია.
      მისი მიზანია დაადგინოს საიდუმლო სიტყვა, თქვენი - კი მისი გამოვლენა.
    </p>
    <button class="btn im-ready" onclick="showMainPage()">
      <i class="fas fa-check-circle"></i> მზად ვარ 
    </button>
  </div>

  <div id="transitionScreen" style="display:none;">
    <div class="spinner"></div>
    <div class="loading-text">თამაშზე გადასვლა...</div>
  </div>

  <div class="particles" id="particles"></div>

  <div class="container" id="mainContent" style="display:none;">
    <div class="logo">
      <h1>SPY</h1>
      <!-- This paragraph is hidden by CSS when game started -->
      <p>მისტიკური თამაში რეალობის გამოცდისთვის</p>
    </div>

    <div id="playerInput" class="section active">
      <div class="input-with-button">
        <input type="text" id="playerName" placeholder="მოთამაშის სახელი" />
        <button class="btn" onclick="addPlayer()">
          <i class="fas fa-plus"></i> დამატება
        </button>
      </div>

      <div class="player-list" id="playerList"></div>

      <div class="input-group">
        <label class="form-label">
          <i class="fas fa-user-secret"></i> ჯაშუშების რაოდენობა:
        </label>
        <select id="spyCount">
          <option value="1">1 ჯაშუში</option>
          <option value="2">2 ჯაშუში</option>
          <option value="3">3 ჯაშუში</option>
        </select>
      </div>

      <div class="input-group">
        <label class="form-label">
          <i class="fas fa-search"></i> დეტექტივის რაოდენობა:
        </label>
        <select id="detectiveCount">
          <option value="0" selected>გამორთვა</option>
          <option value="1">1 დეტექტივი</option>
        </select>
      </div>

      <div class="input-group">
        <label class="form-label">
          <i class="fas fa-star-half-alt"></i> ქულების სისტემა:
        </label>
        <select id="pointsSystem">
          <option value="enabled">ჩართვა</option>
          <option value="disabled" selected>გამორთვა</option>
        </select>
      </div>

      <button class="btn" onclick="startGame()">
        <i class="fas fa-play"></i> თამაშის დაწყება
      </button>
    </div>

    <div id="roleSection" class="section">
      <div class="player-turn" id="playerTurn"></div>
      <div class="role-display">
        <div id="roleDisplay" class="role-text">მომზადება...</div>
        <div id="currentPlayer" class="current-player"></div>
      </div>
      <button class="btn" onclick="revealRole()">
        <i class="fas fa-eye"></i> როლის ნახვა
      </button>
    </div>

    <div id="gameSection" class="section">
      <div class="points-display" id="pointsDisplay"></div>
      <div class="timer-container">
        <div class="timer" id="timer">02:00</div>
      </div>
      <div class="controls">
        <button class="btn" id="startTimerBtn" onclick="startTimer()">
          <i class="fas fa-hourglass-start"></i> ტაიმერის დაწყება
        </button>
        <button class="btn btn-danger" id="revealBtn" onclick="endGame()">
          <i class="fas fa-flag"></i> თამაშის დასრულება
        </button>
      </div>
    </div>

    <div id="findSpySection" class="section">
      <div class="result-display">
        <div class="result-title">მოთამაშეები ეძებენ ჯაშუშს</div>
        <p>დააფიქსირეთ თქვენი ეჭვი, ვინ არის ჯაშუში:</p>
        <select id="findSpySelect"></select>
      </div>
      <div class="controls">
        <button class="btn" onclick="makePlayerGuess()">
          <i class="fas fa-hand-point-right"></i> არჩევა
        </button>
      </div>
    </div>

    <div id="detectiveSection" class="section">
      <div class="result-display">
        <div class="result-title">დეტექტივის სვლა</div>
        <p>დეტექტივმა უნდა გამოიცნოს ჯაშუში.</p>
        <select id="detectiveGuessSelect"></select>
      </div>
      <div class="controls">
        <button class="btn" onclick="detectiveGuess()">
          <i class="fas fa-hand-point-right"></i> გამოცნობა
        </button>
      </div>
    </div>

    <div id="resultSection" class="section">
      <div class="result-display">
        <div class="result-title">თამაში დასრულდა!</div>
        <div id="resultText"></div>
        <div id="resultDisplay" class="spies-list"></div>
        <div id="wordDisplay" class="word-reveal"></div>
      </div>
      <div class="controls result-buttons">
        <button class="btn" id="showPointsBtn" onclick="showFinalPoints()">
          <i class="fas fa-trophy"></i> ქულების ნახვა
        </button>
        <button class="btn" onclick="restartGame()">
          <i class="fas fa-redo"></i> ახალი თამაში
        </button>
      </div>
    </div>
  </div>

  <div id="finalPointsModal" class="modal">
    <div class="modal-content">
      <h3>თამაშის შედეგები</h3>
      <div id="finalPointsContent"></div>
      <button class="btn" onclick="closeModal('finalPointsModal')">
        <i class="fas fa-times-circle"></i> დახურვა
      </button>
    </div>
  </div>

  <audio id="alarmSound">
    <source
      src="https://www.soundjay.com/buttons/sounds/beep-07.mp3"
      type="audio/mpeg"
    />
  </audio>

  <script>
    function createParticles() {
      const particlesContainer = document.getElementById("particles");
      const particleCount = 30;

      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement("div");
        particle.classList.add("particle");

        const size = Math.random() * 3 + 1;
        const posX = Math.random() * 100;
        const delay = Math.random() * 15;
        const duration = 15 + Math.random() * 10;

        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.left = `${posX}%`;
        particle.style.animationDelay = `${delay}s`;
        particle.style.animationDuration = `${duration}s`;

        particlesContainer.appendChild(particle);
      }
    }

    function showReadyScreen() {
      const loadingScreen = document.getElementById("loadingScreen");
      const readyScreen = document.getElementById("readyScreen");
      loadingScreen.style.opacity = "0";
      setTimeout(() => {
        loadingScreen.style.display = "none";
        readyScreen.style.display = "flex";
        readyScreen.style.opacity = "1";
      }, 500);
    }

    function showMainPage() {
      const readyScreen = document.getElementById("readyScreen");
      const mainContent = document.getElementById("mainContent");
      const transitionScreen = document.getElementById("transitionScreen");

      readyScreen.style.opacity = "0";
      setTimeout(() => {
        readyScreen.style.display = "none";
        transitionScreen.style.display = "flex";
        transitionScreen.style.opacity = "1";

        setTimeout(() => {
          transitionScreen.style.opacity = "0";
          setTimeout(() => {
            transitionScreen.style.display = "none";
            mainContent.style.display = "block";
            mainContent.style.opacity = "1";
          }, 500);
        }, 2000);
      }, 500);
    }

    let players = [];
    let roles = [];
    let chosenWord = "";
    let currentIndex = 0;
    let timerInterval;
    let timeLeft = 0;
    let isDetectiveMode = false;
    let isPointsEnabled = false;
    const words = [
      "ფეხბურთი",
      "თეატრი",
      "კომპიუტერი",
      "სახლი",
      "ტელეფონი",
      "საქართველო",
      "კუ",
      "ძაღლი",
      "ჩრდილი",
      "საიდუმლო",
      "ყვავილი",
      "წიგნი",
      "ჩანთა",
      "მთა",
      "საათი",
      "ნაყინი",
      "ფანარი",
      "წყალი",
      "ფანჯარა",
      "კატა",
      "კარადა",
      "სკამი",
      "ტყე",
      "ხე",
      "ცხენი",
      "ბრინჯი",
      "პური",
      "ბოსტანი",
      "ყავა",
      "ჩაი",
      "სასმელი",
      "თევზი",
      "ზღვა",
      "მზა",
      "ვარსკვლავი",
      "მთვარე",
      "ღამე",
      "დღე",
      "ქარი",
      "წვიმა",
      "თოვლი",
      "ფერი",
      "სიტყვა",
      "მელოდია",
      "მუსიკა",
      "პიანინო",
      "გიტარა",
      "ბგერა",
      "ვიდეო",
      "ფილმი",
      "სერიალი",
      "საღამო",
      "დილა",
      "მომენტი",
      "ხედი",
      "კარავი",
      "ბანაკი",
      "საბანი",
      "დრონი",
      "პლედი",
      "მიკროფონი",
      "ჩაფხუტი",
      "სათვალე",
      "ზუგჩანთა",
      "ვერცხლი",
      "ბენზინი",
      "ფაზლი",
      "პლანშეტი",
      "კარტოფილი",
      "ჩამრთველი",
      "კიბე",
      "ხალიჩა",
      "ფარდები",
      "თიხა",
      "ქაფი",
      "ტილო",
      "სანათი",
      "კომპასი",
      "სარკე",
      "ბალიში",
      "ბატონი",
      "ბალახი",
      "დანა",
      "კოვზი",
      "ჩანგალი",
      "თასი",
      "ჭიქა",
      "ყუთი",
      "ბოთლი",
      "საფარი",
      "ბურთი",
      "ხალათი",
      "პლაჟი",
      "ქუდი",
      "კეპი",
      "ჩაფხუტი",
      "ჟილეტი",
      "შარვალი",
      "კომბინიზონი",
      "შარფი",
      "ყურსასმენი",
      "მაკრატელი",
      "გიტარა",
    ];

    function addPlayer() {
      let name = document.getElementById("playerName").value.trim();
      if (name && !players.some((p) => p.name === name)) {
        players.push({ name: name, points: 0 });
        updatePlayerList();
        document.getElementById("playerName").value = "";
      } else if (players.some((p) => p.name === name)) {
        alert("მოთამაშე ამ სახელით უკვე დამატებულია!");
      }
    }

    function updatePlayerList() {
      let list = document.getElementById("playerList");
      list.innerHTML = "";

      if (players.length === 0) {
        list.innerHTML =
          '<div style="padding: 15px; text-align: center; color: var(--color5);">მოთამაშეები არ არიან</div>';
        return;
      }

      players.forEach((p, index) => {
        let item = document.createElement("div");
        item.classList.add("player-item");

        let nameAndPoints = document.createElement("div");
        nameAndPoints.classList.add("player-name-and-points");

        if (isPointsEnabled) {
          nameAndPoints.innerHTML = `<span>${p.name}</span> <span class="player-score">(${p.points})</span>`;
        } else {
          nameAndPoints.innerHTML = `<span>${p.name}</span>`;
        }

        let removeBtn = document.createElement("button");
        removeBtn.classList.add("remove-btn");
        removeBtn.innerHTML = '<i class="fas fa-times"></i>';
        removeBtn.onclick = function () {
          players.splice(index, 1);
          updatePlayerList();
        };

        item.appendChild(nameAndPoints);
        item.appendChild(removeBtn);
        list.appendChild(item);
      });
    }

    function startGame() {
      if (players.length < 3) {
        alert("მინიმუმ 3 მოთამაშე უნდა იყოს!");
        return;
      }

      let spyCount = parseInt(document.getElementById("spyCount").value);
      let detectiveCount = parseInt(
        document.getElementById("detectiveCount").value
      );
      isDetectiveMode = detectiveCount === 1;
      isPointsEnabled = document.getElementById("pointsSystem").value === "enabled";
      if (spyCount + detectiveCount >= players.length) {
        alert(
          "ჯაშუშების და დეტექტივების რაოდენობა უნდა იყოს ნაკლები მოთამაშეების რაოდენობაზე!"
        );
        return;
      }

      chosenWord = words[Math.floor(Math.random() * words.length)];

      roles = Array(players.length).fill("Civilian");
      let indices = [...Array(players.length).keys()];
      indices.sort(() => Math.random() - 0.5);

      let spyIndices = indices.slice(0, spyCount);
      spyIndices.forEach((i) => (roles[i] = "Spy"));
      if (isDetectiveMode) {
        let availableIndices = indices.filter((i) => !spyIndices.includes(i));
        let detectiveIndex = availableIndices[0];
        roles[detectiveIndex] = "Detective";
      }

      let combined = players.map((p, i) => ({
        name: p.name,
        role: roles[i],
        points: p.points,
      }));
      combined.sort(() => Math.random() - 0.5);

      players = combined.map((c) => ({ name: c.name, points: c.points }));
      roles = combined.map((c) => c.role);
      if (isPointsEnabled) {
        document.getElementById("showPointsBtn").style.display = "inline-flex";
      } else {
        document.getElementById("showPointsBtn").style.display = "none";
      }

      document.getElementById("playerInput").classList.remove("active");
      document.getElementById("roleSection").classList.add("active");

      currentIndex = 0;
      updateTurnDisplay();
    }

    function updateTurnDisplay() {
      document.getElementById(
        "playerTurn"
      ).textContent = `${players[currentIndex].name} დააჭირე რომ ნახო შენი როლი`;
      document.getElementById(
        "currentPlayer"
      ).textContent = `${currentIndex + 1} / ${players.length}`;
      document.getElementById("roleDisplay").textContent =
        "მომზადება როლის საჩვენებლად...";
    }

    function revealRole() {
      let display = document.getElementById("roleDisplay");
      let role = roles[currentIndex];
      display.classList.remove("spy-text", "word-text");
      if (role === "Spy") {
        display.innerHTML = `<span class="spy-text">ჯაშუში</span>`;
      } else if (role === "Detective") {
        display.innerHTML = `შენ ხარ <span class="word-text">დეტექტივი</span>`;
      } else {
        display.innerHTML = `სიტყვა: <span class="word-text">${chosenWord}</span>`;
      }

      currentIndex++;

      if (currentIndex < players.length) {
        setTimeout(() => {
          updateTurnDisplay();
        }, 2000);
      } else {
        setTimeout(() => {
          document.getElementById("roleSection").classList.remove("active");
          document.getElementById("gameSection").classList.add("active");
          if (isPointsEnabled) {
            document.getElementById("pointsDisplay").style.display = "block";
            updatePointsDisplay();
          } else {
            document.getElementById("pointsDisplay").style.display = "none";
          }
        }, 2000);
      }
    }

    function startTimer() {
      document.getElementById("startTimerBtn").style.display = "none";
      timeLeft = 120;
      updateTimerDisplay(timeLeft);

      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        timeLeft--;
        updateTimerDisplay(timeLeft);
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          document.getElementById("timer").textContent = "დრო ამოიწურა!";
          document.getElementById("alarmSound").play();
          showFindSpySection();
        }
      }, 1000);
    }

    function updateTimerDisplay(time) {
      let minutes = String(Math.floor(time / 60)).padStart(2, "0");
      let seconds = String(time % 60).padStart(2, "0");
      document.getElementById("timer").textContent = `${minutes}:${seconds}`;
    }

    function updatePointsDisplay() {
      let pointsHtml = "";
      players.forEach((p, i) => {
        pointsHtml += `<span>${p.name}: ${p.points}</span> | `;
      });
      document.getElementById("pointsDisplay").innerHTML = pointsHtml.slice(0, -2);
    }

    function endGame() {
      clearInterval(timerInterval);
      showFindSpySection();
    }

    function showFindSpySection() {
      document.getElementById("gameSection").classList.remove("active");
      document.getElementById("findSpySection").classList.add("active");

      let select = document.getElementById("findSpySelect");
      select.innerHTML = "";
      players.forEach((p, i) => {
        let option = document.createElement("option");
        option.value = i;
        option.textContent = p.name;
        select.appendChild(option);
      });
    }

    function makePlayerGuess() {
      let guessIndex = parseInt(document.getElementById("findSpySelect").value);

      document.getElementById("findSpySection").classList.remove("active");
      if (isDetectiveMode && roles[guessIndex] === "Detective") {
        endGameWithDetectiveLoss(guessIndex);
      } else {
        endGameWithPlayerGuess(guessIndex);
      }
    }

    function endGameWithPlayerGuess(guessIndex) {
      let spyIndex = roles.indexOf("Spy");
      let resultText = "";

      if (isPointsEnabled) {
        if (guessIndex === spyIndex) {
          players[spyIndex].points -= 30;
          resultText = "თქვენ სწორად იპოვეთ ჯაშუში!";
        } else {
          players[spyIndex].points += 70;
          resultText = "თქვენ ვერ იპოვეთ ჯაშუში!";
        }
      } else {
        if (guessIndex === spyIndex) {
          resultText = "წააგო ჯაშუშმა!";
        } else {
          resultText = "მოიგო ჯაშუშმა!";
        }
      }

      if (isDetectiveMode && guessIndex !== spyIndex) {
        document.getElementById("resultText").textContent = resultText;
        showDetectiveGuessSection();
      } else {
        document.getElementById("resultText").textContent = resultText;
        revealSpies();
      }
    }

    function endGameWithDetectiveLoss(detectiveIndex) {
      let resultText = "თამაში დასრულდა! თქვენ მოკალით დეტექტივი.";
      let spyIndex = roles.indexOf("Spy");

      if (isPointsEnabled) {
        if (spyIndex !== -1) {
          players[spyIndex].points += 70;
        }
      }

      document.getElementById("resultText").textContent = resultText;
      revealSpies();
    }

    function showDetectiveGuessSection() {
      document.getElementById("detectiveSection").classList.add("active");
      let select = document.getElementById("detectiveGuessSelect");
      select.innerHTML = "";
      players.forEach((p, i) => {
        if (roles[i] !== "Detective") {
          let option = document.createElement("option");
          option.value = i;
          option.textContent = p.name;
          select.appendChild(option);
        }
      });
    }

    function detectiveGuess() {
      let guessIndex = parseInt(
        document.getElementById("detectiveGuessSelect").value
      );
      let spyIndex = roles.indexOf("Spy");
      let detectiveIndex = roles.indexOf("Detective");
      let resultText = "";
      if (isPointsEnabled) {
        if (guessIndex === spyIndex) {
          players[detectiveIndex].points += 50;
          if (spyIndex !== -1) players[spyIndex].points -= 20;
          resultText = `დეტექტივმა, ${players[detectiveIndex].name}-მ, სწორად გამოიცნო!`;
        } else {
          players[detectiveIndex].points -= 10;
          if (spyIndex !== -1) players[spyIndex].points += 30;
          resultText = `დეტექტივმა, ${players[detectiveIndex].name}-მ, ვერ გამოიცნო.`;
        }
      } else {
        if (guessIndex === spyIndex) {
          resultText = "დეტექტივმა სწორად გამოიცნო! ჯაშუშმა წააგო.";
        } else {
          resultText = "დეტექტივმა ვერ გამოიცნო. ჯაშუშმა მოიგო.";
        }
      }

      document.getElementById("resultText").textContent = resultText;
      document.getElementById("detectiveSection").classList.remove("active");
      revealSpies();
    }

    function revealSpies() {
      let spies = roles
        .map((r, i) => (r === "Spy" ? players[i].name : null))
        .filter(Boolean);
      let spiesText = spies.join(", ");

      document.getElementById("resultDisplay").textContent = `ჯაშუში: ${spiesText}`;
      document.getElementById("wordDisplay").textContent = `სიტყვა იყო: ${chosenWord}`;

      document.getElementById("resultSection").classList.add("active");
    }

    function showFinalPoints() {
      let modal = document.getElementById("finalPointsModal");
      let content = document.getElementById("finalPointsContent");
      content.innerHTML = "";
      players.forEach((p) => {
        let item = document.createElement("div");
        item.classList.add("player-score-item");
        item.innerHTML = `<span class="name">${p.name}:</span> <span class="points">${p.points}</span>`;
        content.appendChild(item);
      });
      modal.style.display = "flex";
    }

    function closeModal(id) {
      document.getElementById(id).style.display = "none";
    }

    function restartGame() {
      document.getElementById("resultSection").classList.remove("active");
      document.getElementById("playerInput").classList.add("active");

      currentIndex = 0;
      updatePlayerList();
      document.getElementById("startTimerBtn").style.display = "block";
      document.getElementById("timer").textContent = "02:00";
    }

    window.onload = function () {
      createParticles();
      updatePlayerList();
      setTimeout(showReadyScreen, 1000);
    };
  </script>

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js")
    .then(reg => console.log("Service Worker registered", reg))
    .catch(err => console.error("Service Worker registration failed", err));
}
</script>

</body>
</html>